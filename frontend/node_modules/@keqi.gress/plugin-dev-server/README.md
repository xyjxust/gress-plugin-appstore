# @keqi.gress/plugin-dev-server

Gress æ’ä»¶å‰ç«¯å¼€å‘æœåŠ¡å™¨ - æä¾›çƒ­æ›´æ–°å’Œåç«¯è”è°ƒèƒ½åŠ›

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- âš¡ï¸ åŸºäº Vite çš„å¿«é€Ÿçƒ­æ›´æ–° (HMR)
- ğŸ”„ è‡ªåŠ¨ä»£ç†åç«¯ API è¯·æ±‚
- ğŸ¨ æ”¯æŒè‡ªå®šä¹‰ Vite é…ç½®
- ğŸ“¦ é›¶é…ç½®å¯åŠ¨ï¼Œå¼€ç®±å³ç”¨
- ğŸ”§ çµæ´»çš„é…ç½®é€‰é¡¹
- ğŸš€ æ”¯æŒå¤šæ’ä»¶å¹¶è¡Œå¼€å‘
- ğŸ›£ï¸ å®Œæ•´æ”¯æŒ Vue Routerï¼ˆHistory/Hash æ¨¡å¼ï¼‰
- ğŸ¤– **è‡ªåŠ¨æ‰«æ views ç›®å½•ç”Ÿæˆè·¯ç”±**ï¼ˆçº¦å®šä¼˜äºé…ç½®ï¼‰
- ğŸ¯ **Mock API æ”¯æŒ**ï¼ˆæ¨¡æ‹Ÿåç«¯è·¯ç”±å’Œèœå•é…ç½®ï¼‰

## ğŸ“¦ å®‰è£…

åœ¨æ’ä»¶å‰ç«¯é¡¹ç›®ä¸­å®‰è£…ï¼š

```bash
npm install @keqi.gress/plugin-dev-server --save-dev
```

æˆ–ä½¿ç”¨æœ¬åœ°è·¯å¾„ï¼ˆå¼€å‘é˜¶æ®µï¼‰ï¼š

```bash
npm install file:../../gress/gress-plugin-packages/plugin-dev-server --save-dev
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### é›¶é…ç½®æ¨¡å¼ï¼ˆæ¨èï¼‰

**åªéœ€ 3 æ­¥ï¼Œæ— éœ€åˆ›å»ºä»»ä½•è·¯ç”±æ–‡ä»¶ï¼**

```bash
# 1. åˆ›å»º views ç»„ä»¶
mkdir -p src/views
echo '<template><div>é¦–é¡µ</div></template>' > src/views/HomePage.vue

# 2. åˆ›å»ºé…ç½®æ–‡ä»¶
echo 'export default { pluginName: "my-plugin" }' > gress-dev.config.js

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npx gress-dev
```

è®¿é—® `http://localhost:3000/` å³å¯çœ‹åˆ°é¡µé¢ï¼

**å·¥ä½œåŸç†ï¼š**
- âœ… è‡ªåŠ¨æ‰«æ `src/views` ç›®å½•
- âœ… è‡ªåŠ¨ç”Ÿæˆè·¯ç”±é…ç½®
- âœ… è‡ªåŠ¨æ³¨å…¥åº”ç”¨å…¥å£ï¼ˆmain.tsã€App.vueã€routerï¼‰
- âœ… è‡ªåŠ¨å¯åŠ¨å¼€å‘æœåŠ¡å™¨

**ä½ åªéœ€è¦ï¼š**
- åˆ›å»º Vue ç»„ä»¶
- é…ç½®æ’ä»¶åç§°

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨æ’ä»¶å‰ç«¯æ ¹ç›®å½•åˆ›å»º `gress-dev.config.js`ï¼š

```javascript
export default {
  // æ’ä»¶åç§°ï¼ˆå¿…å¡«ï¼‰
  pluginName: 'appstore',
  
  // åç«¯æœåŠ¡åœ°å€ï¼ˆå¯é€‰ï¼Œé»˜è®¤ http://localhost:8080ï¼‰
  backendUrl: 'http://localhost:8080',
  
  // å¼€å‘æœåŠ¡å™¨ç«¯å£ï¼ˆå¯é€‰ï¼Œé»˜è®¤ 3000ï¼‰
  port: 3001,
  
  // API å‰ç¼€ï¼ˆå¯é€‰ï¼Œé»˜è®¤ /api/plugin/{pluginName}ï¼‰
  apiPrefix: '/api/plugin/appstore',
  
  // æ˜¯å¦è‡ªåŠ¨æ‰«æ views ç›®å½•ç”Ÿæˆè·¯ç”±ï¼ˆå¯é€‰ï¼Œé»˜è®¤ trueï¼‰
  autoScanRoutes: true,
  
  // æ‰‹åŠ¨é…ç½®çš„è·¯ç”±ï¼ˆå¯é€‰ï¼Œä¼šè¦†ç›–è‡ªåŠ¨æ‰«æçš„è·¯ç”±ï¼‰
  devRoutes: [
    // ç‰¹æ®Šè·¯ç”±å¯ä»¥åœ¨è¿™é‡Œé…ç½®
    {
      path: '/custom-path',
      component: 'CustomPage',
      meta: { title: 'è‡ªå®šä¹‰é¡µé¢' }
    }
  ],
  
  // æ˜¯å¦å¯ç”¨çƒ­æ›´æ–°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ trueï¼‰
  hmr: true,
  
  // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼ˆå¯é€‰ï¼Œé»˜è®¤ falseï¼‰
  open: false,
  
  // è·¯ç”±åŸºç¡€è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤ '/'ï¼‰
  // ç”¨äºå­è·¯å¾„éƒ¨ç½²ï¼Œå¦‚ '/plugins/appstore/'
  base: '/'
}
```

### 2. ä¿®æ”¹ package.json

```json
{
  "scripts": {
    "dev": "gress-dev",
    "build": "vite build"
  },
  "devDependencies": {
    "@keqi.gress/plugin-dev-server": "^1.0.0"
  }
}
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

## ğŸ“– é…ç½®é€‰é¡¹

### åŸºç¡€é…ç½®

```typescript
interface GressDevConfig {
  /** æ’ä»¶åç§°ï¼ˆå¿…å¡«ï¼‰ */
  pluginName: string
  
  /** åç«¯æœåŠ¡åœ°å€ï¼ˆå¯é€‰ï¼‰ */
  backendUrl?: string
  
  /** å¼€å‘æœåŠ¡å™¨ç«¯å£ï¼ˆå¯é€‰ï¼‰ */
  port?: number
  
  /** API å‰ç¼€ï¼ˆå¯é€‰ï¼‰ */
  apiPrefix?: string
  
  /** æ˜¯å¦å¯ç”¨çƒ­æ›´æ–°ï¼ˆå¯é€‰ï¼‰ */
  hmr?: boolean
  
  /** æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼ˆå¯é€‰ï¼‰ */
  open?: boolean
  
  /** é¢å¤–çš„ Vite é…ç½®ï¼ˆå¯é€‰ï¼‰ */
  vite?: InlineConfig
  
  /** é¢å¤–çš„ä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰ */
  proxy?: Record<string, any>
}
```

### é«˜çº§é…ç½®ç¤ºä¾‹

```javascript
export default {
  pluginName: 'portal',
  backendUrl: 'http://localhost:8080',
  port: 3002,
  
  // è‡ªå®šä¹‰ Vite é…ç½®
  vite: {
    resolve: {
      alias: {
        '@': '/src'
      }
    },
    css: {
      preprocessorOptions: {
        scss: {
          additionalData: `@import "@/styles/variables.scss";`
        }
      }
    }
  },
  
  // é¢å¤–çš„ä»£ç†é…ç½®
  proxy: {
    '/api/other': {
      target: 'http://localhost:9000',
      changeOrigin: true
    }
  }
}
```

## ğŸ”§ å‘½ä»¤è¡Œé€‰é¡¹

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®
gress-dev

# æŒ‡å®šç«¯å£
gress-dev --port 3003

# è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
gress-dev --open

# æŒ‡å®šé…ç½®æ–‡ä»¶
gress-dev --config custom-config.js
```

## ğŸŒŸ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šé›¶é…ç½®å¼€å‘ï¼ˆæ¨èï¼‰

```bash
cd gress-plugin-appstore/frontend

# åˆ›å»º views ç»„ä»¶
mkdir -p src/views
echo '<template><div>é¦–é¡µ</div></template>' > src/views/HomePage.vue
echo '<template><div>åˆ—è¡¨</div></template>' > src/views/ApplicationList.vue

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆè‡ªåŠ¨æ‰«æ views ç›®å½•ç”Ÿæˆè·¯ç”±ï¼‰
npm run dev
```

è®¿é—®ï¼š
- `http://localhost:3001/` â†’ HomePage.vue
- `http://localhost:3001/application-list` â†’ ApplicationList.vue

### åœºæ™¯ 2ï¼šè‡ªå®šä¹‰è·¯ç”±

```javascript
// gress-dev.config.js
export default {
  pluginName: 'appstore',
  
  // æ‰‹åŠ¨é…ç½®ç‰¹æ®Šè·¯ç”±
  devRoutes: [
    {
      path: '/applications',  // è‡ªå®šä¹‰è·¯å¾„
      component: 'ApplicationList',
      meta: { title: 'åº”ç”¨åˆ—è¡¨', icon: 'Apps' }
    },
    {
      path: '/applications/:id',
      component: 'ApplicationDetail',
      meta: { title: 'åº”ç”¨è¯¦æƒ…' }
    }
  ]
}
```

### åœºæ™¯ 3ï¼šå¤šæ’ä»¶å¹¶è¡Œå¼€å‘

```bash
# ç»ˆç«¯ 1 - å¯åŠ¨ appstore æ’ä»¶
cd gress-plugin-appstore/frontend
npm run dev  # ç«¯å£ 3001

# ç»ˆç«¯ 2 - å¯åŠ¨ portal æ’ä»¶
cd gress-plugin-portal/frontend
npm run dev  # ç«¯å£ 3002
```

### åœºæ™¯ 3ï¼šè”è°ƒåç«¯ API

æ‰€æœ‰å‘é€åˆ° `apiPrefix` çš„è¯·æ±‚ä¼šè‡ªåŠ¨ä»£ç†åˆ°åç«¯ï¼š

```typescript
// å‰ç«¯ä»£ç 
const response = await fetch('/api/plugin/appstore/applications')
// å®é™…è¯·æ±‚: http://localhost:8080/api/plugin/appstore/applications
```

### åœºæ™¯ 4ï¼šè®¿é—®è·¯ç”±

æ‰€æœ‰å‰ç«¯è·¯ç”±éƒ½å¯ä»¥ç›´æ¥è®¿é—®ï¼Œæ”¯æŒæµè§ˆå™¨åˆ·æ–°ï¼š

```
http://localhost:3001/                    # é¦–é¡µ
http://localhost:3001/applications        # åº”ç”¨åˆ—è¡¨
http://localhost:3001/settings            # è®¾ç½®é¡µ
```

è¯¦è§ [è·¯ç”±è®¿é—®æŒ‡å—](./ROUTING_GUIDE.md)

## ğŸ¨ ç¯å¢ƒå˜é‡æ³¨å…¥

å¼€å‘æœåŠ¡å™¨ä¼šè‡ªåŠ¨æ³¨å…¥ä»¥ä¸‹å…¨å±€å˜é‡ï¼š

```typescript
declare const __PLUGIN_NAME__: string      // æ’ä»¶åç§°
declare const __API_PREFIX__: string       // API å‰ç¼€
declare const __BACKEND_URL__: string      // åç«¯åœ°å€
```

åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼š

```typescript
console.log('Plugin:', __PLUGIN_NAME__)
console.log('API Prefix:', __API_PREFIX__)
```

## ğŸ“ TypeScript æ”¯æŒ

åˆ›å»º `env.d.ts` æ–‡ä»¶ï¼š

```typescript
/// <reference types="vite/client" />

declare const __PLUGIN_NAME__: string
declare const __API_PREFIX__: string
declare const __BACKEND_URL__: string
```

## ğŸ” è°ƒè¯•

å¼€å‘æœåŠ¡å™¨ä¼šè¾“å‡ºä»£ç†è¯·æ±‚æ—¥å¿—ï¼š

```
[Proxy] GET /api/plugin/appstore/applications -> http://localhost:8080/api/plugin/appstore/applications
```

## ğŸ“„ License

MIT

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](./QUICK_START.md)
- [é›†æˆæŒ‡å—](./INTEGRATION_GUIDE.md)
- [è·¯ç”±è®¿é—®æŒ‡å—](./ROUTING_GUIDE.md)
- [è‡ªåŠ¨è·¯ç”±æ‰«ææŒ‡å—](./AUTO_ROUTES_GUIDE.md) â­ æ–°åŠŸèƒ½
- [å¼€å‘ç¯å¢ƒè·¯ç”±é…ç½®](./DEV_ROUTES_GUIDE.md)
- [é…ç½®ç¤ºä¾‹](./config/gress-dev.config.example.js)
